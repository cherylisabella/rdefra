---
title: "rdefra: Interact with the UK AIR Pollution Database from DEFRA"
author: "Claudia Vitolo"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{rdefra}
  %\VignetteEngine{knitr::knitr}
  %\usepackage[UTF-8]{inputenc}
---

```{r setup, echo=FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  warning = FALSE,
  message = FALSE
)
```

# Introduction
The package rdefra allows to retrieve air pollution data from the Air Information Resource (UK-AIR, https://uk-air.defra.gov.uk/) of the Department for Environment, Food and Rural Affairs (DEFRA) in the United Kingdom. UK-AIR does not provide a public API for programmatic access to data, therefore this package scrapes the HTML pages to get relevant information.

This package follows a logic similar to other packages such as waterData and rnrfa: sites are first identified through a catalogue, data are imported via the station identification number, then visualised and/or used in analyses. The information related to the monitoring stations is accessible through the function `ukair_catalogue()`. Some station may have missing coordinates, which can be recovered using the function `ukair_get_coordinates()`. Lastly, time series data related to different pollutants can be obtained using the function `ukair_get_hourly_data()`.

The package is designed to collect data efficiently. It allows to download multiple years of data for a single station with one line of code and, if used with the parallel package, allows the acquisition of data from hundreds of sites in only few minutes.

## Installation

Get the released version from CRAN:

```{r installation_cran, eval = FALSE}
install.packages("rdefra")
```

Or the development version from github using [devtools](https://github.com/hadley/devtools):

```{r installation_github, eval = FALSE}
devtools::install_github("ropensci/rdefra")
```

Load the rdefra package:

```{r load_library}
library("rdefra")
```

## Functions

The package logic assumes that users access the UK-AIR database in two steps:

1. Browse the catalogue of available stations and selects some stations of interest.
2. Retrieves data for the selected stations.

### Get stations catalogue

The list of monitoring stations can be downloaded using the function `ukair_catalogue()` with no input parameters, as in the example below. 

```{r catalogue_full, eval = TRUE}
# Get full catalogue
stations <- ukair_catalogue()
stations
```

There are currently `r dim(stations)[1]` stations in UK-AIR. The same function, can be used to filter the catalogue using the following input parameters:

* `site_name` IDs of specific site (UK.AIR.ID). By default this is left blank to get info on all the available sites.
* `pollutant` This is an integer between 1 and 10. Default is 9999, which means all the pollutants.
* `group_id` This is the identification number of a group of stations. Default is 9999 which means all available networks.
* `closed` This is set to TRUE to include closed stations, FALSE otherwise.
* `country_id` This is the identification number of the country, it can be an integer between 1 and 6. Default is 9999, which means all the countries.
* `region_id` This is the identification number of the region. 1 = Aberdeen City, etc. (for the full list see https://uk-air.defra.gov.uk/). Default is 9999, which means all the local authorities.
